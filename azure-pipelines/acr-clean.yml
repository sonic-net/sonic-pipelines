pr: none
trigger: none

schedules:
- cron: '0 0 * * *'
  always: true
  branches:
    include:
    - main

jobs:
- job: cleanup
  pool: sonic-ubuntu-1c
  timeoutInMinutes: 240

  steps:
    - checkout: none
    - script: |
        curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
      displayName: install dependencies
    - task: AzureCLI@2
      displayName: clean ACR
      inputs:
        azureSubscription: 'WIF-soniccr1'
        scriptType: 'bash'
        scriptLocation: 'inlineScript'
        inlineScript: |
          az account show | base64
          for registry in $(sonic_acrs); do
            az acr run --registry $registry --cmd "acr purge --filter '.*:.*'  --ago 1200d " --timeout 3600 /dev/null || true
            az acr run --registry $registry --cmd "acr purge --filter '.*:.*bld.*' --ago 365d" --timeout 3600 /dev/null || true
            az acr run --registry $registry --cmd "acr purge --filter '.*:.*' --untagged --ago 360d" --timeout 3600 /dev/null || true
          done
